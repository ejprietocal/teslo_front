import{a as M}from"./chunk-OB5GQYWL.js";import{a as te}from"./chunk-G5KA7DMQ.js";import{a as F}from"./chunk-N7KMSJ3L.js";import"./chunk-UISL6Y2D.js";import"./chunk-L3V7LWUT.js";import{b as ee}from"./chunk-MS4GMOMR.js";import"./chunk-BGKHSOXA.js";import{a as ae}from"./chunk-22XGGMEN.js";import{b as G,c as y,d as z,e as P,f as H,h as B,i as O,j as $,k as Z,l as J,n as K,o as X,p as Y}from"./chunk-7WT757UQ.js";import{a as k}from"./chunk-WRBWQDOP.js";import"./chunk-S4Z3L45U.js";import{h as Q,n as D}from"./chunk-VGTGXULN.js";import{$ as S,Bb as w,Cb as E,Db as _,Eb as i,Gb as N,Ja as c,Jb as q,T as p,Ua as u,Yb as I,Za as T,_ as v,aa as R,ba as W,db as m,ib as b,mb as r,na as g,nb as o,ob as s,rb as x,wb as f}from"./chunk-SNWDAWOK.js";var ne=["createCategory"],re=l=>({"border-red-500!":l});function le(l,a){l&1&&(r(0,"p",13),i(1,"Este campo es requerido"),o())}function se(l,a){l&1&&(r(0,"p",13),i(1,"El nombre debe tener al menos 3 caracteres"),o())}function ce(l,a){l&1&&(r(0,"p",13),i(1,"Este campo es requerido"),o())}function de(l,a){l&1&&(r(0,"p",13),i(1,"La descripci\xF3n debe tener al menos 3 caracteres"),o())}var V=class l{categoryCreatedSignal;categories=[];categoryId;mode;resetForm;createCategory;createCategorySub;createCategoryService=p(M);fb=p(K);loaderService=p(k);toastr=p(F);updateCategorySub;constructor(){I(()=>{this.categoryId()&&this.mode()==="modify"&&this.createCategoryService.getCategory(this.categoryId()).subscribe({next:a=>{this.form.get("description")?.setValue(a.description),this.form.get("isActive")?.setValue(a.isActive),this.form.get("name")?.setValue(a.name)},error:a=>{console.error("Error al obtener la categor\xEDa:",a),this.loaderService.deactivateInternalSignal(),this.toastr.error(a.error.message)}}),this.resetForm()&&(this.form.reset({name:"",description:"",isActive:!0}),this.resetForm.set(!1))})}textModalmodify={title:"Modificar Categor\xEDa",button:"Modificar"};textModalCreate={title:"Crear Categor\xEDa",button:"Crear"};form=this.fb.group({description:["",[y.required,y.minLength(3)]],id_business:[""],isActive:[!0,y.required],name:["",[y.required,y.minLength(3)]]});onSubmitCategory(){this.loaderService.activateInternalSignal();let{id_business:a}=te(localStorage.getItem("auth_token"));this.form.get("id_business")?.setValue(a),this.mode()==="create"?this.createCategorySub=this.createCategoryService.createCategory(this.form).subscribe({next:e=>{},complete:()=>{this.categoryCreatedSignal.set(!0),this.createCategory.nativeElement.classList.add("hidden"),this.createCategorySub?.unsubscribe(),this.loaderService.deactivateInternalSignal(),this.toastr.success("Categor\xEDa creada exitosamente"),this.form.reset({name:"",description:"",isActive:!0})},error:e=>{console.error("Error en la creaci\xF3n de categor\xEDa:",e),this.loaderService.deactivateInternalSignal(),this.toastr.error(e.error.message),this.form.reset({name:"",description:"",isActive:!0})}}):this.updateCategorySub=this.createCategoryService.updateCategory(this.form,this.categoryId()).subscribe({next:e=>{this.createCategory.nativeElement.classList.add("hidden"),this.loaderService.deactivateInternalSignal(),this.toastr.success("Categor\xEDa actualizada exitosamente"),this.categoryCreatedSignal.set(!0),this.updateCategorySub?.unsubscribe(),this.form.reset({name:"",description:"",isActive:!0}),this.categoryId.set(NaN)},error:e=>{console.error("Error en la actualizaci\xF3n de categor\xEDa:",e),this.loaderService.deactivateInternalSignal(),this.toastr.error(e.error.message),this.form.reset({name:"",description:"",isActive:!0})}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=u({type:l,selectors:[["app-create-category"]],viewQuery:function(e,t){if(e&1&&w(ne,5),e&2){let n;E(n=_())&&(t.createCategory=n.first)}},inputs:{categoryCreatedSignal:"categoryCreatedSignal",categories:"categories",categoryId:"categoryId",mode:"mode",resetForm:"resetForm"},decls:42,vars:17,consts:[["createCategory",""],["id","createCategory","tabindex","-1",1,"absolute","hidden","justify-center","items-center","top-0","left-0","backdrop-blur-xs","w-full","h-full","z-10"],[1,"w-sm","md:w-md","lg:w-lg","h-fit","bg-color","rounded-xl","p-5","relative","animate-fadeIn"],["type","button","data-modal-hide","createCategory","aria-hidden","true",1,"absolute","cursor-pointer","top-3","end-2.5","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white"],["type","button",1,"fa-solid","fa-close","cursor-pointer","text-xl"],[1,"sr-only"],[1,"h4","mb-2"],[1,"fa","fa-plus"],[1,"mt-5",3,"ngSubmit","formGroup"],[1,"mb-8","relative","grid","grid-cols-3","gap-2"],[1,"col-span-2"],["for","name",1,"label-behavior"],["type","text","id","name","formControlName","name","placeholder","Escribe el nombre de la categor\xEDa",1,"input-behavior",3,"ngClass"],[1,"text-red-500","text-sm","absolute"],["for","estado",1,"label-behavior"],["id","estado","type","text","formControlName","isActive",1,"input-behavior"],[3,"ngValue","selected"],[1,"fa","fa-check"],[3,"ngValue"],[1,"fa","fa-close"],[1,"mb-10","relative"],["for","description",1,"label-behavior"],["id","description","formControlName","description","rows","5","placeholder","Escribe la descripci\xF3n de la categor\xEDa",1,"input-behavior",3,"ngClass"],[1,"mb-3","flex","justify-between"],["type","button","data-modal-hide","createCategory",1,"button-cancel"],[1,"fa","fa-ban"],["type","submit",1,"button-create",3,"disabled"]],template:function(e,t){if(e&1){let n=x();r(0,"div",1,0)(2,"div",2)(3,"button",3),s(4,"span",4),r(5,"span",5),i(6,"Close modal"),o()(),r(7,"h4",6),s(8,"span",7),i(9),o(),s(10,"hr"),r(11,"form",8),f("ngSubmit",function(){return v(n),S(t.onSubmitCategory())}),r(12,"div",9)(13,"div",10)(14,"label",11),i(15,"Nombre"),o(),s(16,"input",12),T(17,le,2,0,"p",13)(18,se,2,0,"p",13),o(),r(19,"div")(20,"label",14),i(21,"Estado"),o(),r(22,"select",15)(23,"option",16),s(24,"span",17),i(25," Activo"),o(),r(26,"option",18),s(27,"span",19),i(28," Inactivo"),o()()()(),r(29,"div",20)(30,"label",21),i(31,"Descripci\xF3n"),o(),s(32,"textarea",22),T(33,ce,2,0,"p",13)(34,de,2,0,"p",13),o(),r(35,"div",23)(36,"button",24),s(37,"span",25),i(38," Cancelar"),o(),r(39,"button",26),s(40,"span",17),i(41),o()()()()()}if(e&2){let n,d,U,C,h,j;c(9),N(" ",t.mode()==="create"?t.textModalCreate.title:t.textModalmodify.title,""),c(2),m("formGroup",t.form),c(5),m("ngClass",q(13,re,((n=t.form.get("name"))==null?null:n.hasError("required"))&&((n=t.form.get("name"))==null?null:n.touched))),c(),b((d=t.form.get("name"))!=null&&d.hasError("required")&&((d=t.form.get("name"))!=null&&d.touched)?17:-1),c(),b((U=t.form.get("name"))!=null&&U.hasError("minlength")?18:-1),c(5),m("ngValue",!0)("selected",!0),c(3),m("ngValue",!1),c(6),m("ngClass",q(15,re,((C=t.form.get("description"))==null?null:C.hasError("required"))&&((C=t.form.get("description"))==null?null:C.touched))),c(),b((h=t.form.get("description"))!=null&&h.hasError("required")&&((h=t.form.get("description"))!=null&&h.touched)?33:-1),c(),b((j=t.form.get("description"))!=null&&j.hasError("minlength")?34:-1),c(5),m("disabled",t.form.invalid),c(2),N(" ",t.mode()==="create"?t.textModalCreate.button:t.textModalmodify.button,"")}},dependencies:[D,Q,ee,X,H,Z,J,G,$,z,P,Y,B,O],encapsulation:2})};var A=class l{actionCreateCategor;static \u0275fac=function(e){return new(e||l)};static \u0275cmp=u({type:l,selectors:[["app-delete-category"]],inputs:{actionCreateCategor:"actionCreateCategor"},decls:16,vars:0,consts:[["id","delete-modal","tabindex","-1",1,"backdrop-blur-xs","hidden","overflow-y-auto","overflow-x-hidden","absolute","top-0","right-0","left-0","z-50","justify-center","items-center","w-full","md:inset-0","h-[calc(100%-1rem)]","max-h-full"],[1,"relative","p-4","w-full","max-w-md","max-h-full"],[1,"relative","bg-color","rounded-xl","animate-fadeIn"],["type","button","data-modal-hide","delete-modal",1,"absolute","cursor-pointer","top-3","end-2.5","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white"],["type","button",1,"fa-solid","fa-close","cursor-pointer","text-xl"],[1,"sr-only"],[1,"p-4","md:p-5","text-center"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 20 20",1,"mx-auto","mb-4","text-gray-400","w-12","h-12","dark:text-gray-200"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"],[1,"mb-5","text-lg","font-normal","text-gray-500","dark:text-gray-400"],["data-modal-hide","delete-modal","type","button",1,"text-white","bg-red-600","hover:bg-red-800","focus:ring-4","focus:outline-none","focus:ring-red-300","dark:focus:ring-red-800","font-medium","rounded-lg","text-sm","inline-flex","items-center","px-5","py-2.5","text-center",3,"click"],["data-modal-hide","delete-modal","type","button",1,"py-2.5","px-5","ms-3","text-sm","font-medium","text-gray-900","focus:outline-none","bg-white","rounded-lg","border","border-gray-200","hover:bg-gray-100","hover:text-blue-700","focus:z-10","focus:ring-4","focus:ring-gray-100","dark:focus:ring-gray-700","dark:bg-gray-800","dark:text-gray-400","dark:border-gray-600","dark:hover:text-white","dark:hover:bg-gray-700"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),s(4,"span",4),r(5,"span",5),i(6,"Close modal"),o()(),r(7,"div",6),R(),r(8,"svg",7),s(9,"path",8),o(),W(),r(10,"h3",9),i(11,"Estas seguro de eliminar esta categor\xEDa?"),o(),r(12,"button",10),f("click",function(){return t.actionCreateCategor.set(!0)}),i(13," Si, eliminar "),o(),r(14,"button",11),i(15,"No, cancelar"),o()()()()())},encapsulation:2})};var me=["categoryWrapper"],L=class l{category;categories=[];categoriesSend=[];categoryDeletedSuscription;categorySuscription;categoryService=p(M);loaderService=p(k);toastr=p(F);categoryCreated=g(!1);resetForm=g(!1);actionDeleteCategory=g(!1);categoryId=g(0);mode=g("");dataTableInstance;constructor(){I(()=>{this.categoryCreated()&&(this.fetchCategories(),this.categoryCreated.set(!1)),this.actionDeleteCategory()&&(this.deleteCategory(),this.actionDeleteCategory.set(!1))})}datos={headings:["nombre","descripcion","estado","opciones"],data:[]};fetchCategories(){this.loaderService.activateInternalSignal(),this.categorySuscription=this.categoryService.getCategories().subscribe({next:a=>{this.categories=a.map(e=>[e.name,e.description,e.isActive,e.id]),this.categoriesSend=a,this.datos.data=this.categories,this.dataTableInstance&&this.dataTableInstance.destroy(),this.dataTableInstance=new ae(this.category.nativeElement,{searchable:!0,paging:!0,sortable:!0,columns:[{select:2,type:"string",render:function(e,t,n,d){return e?'<div class="text-center w-full"><span class="fa fa-check text-green-500"></span> Activo</div>':'<div class="text-center w-full"><span class="fa fa-times text-red-500"></span> Inactivo</div>'}},{select:3,type:"string",render:function(e,t,n,d){return`
                  <div class="flex justify-center items-center gap-5 w-full">
                  <button type="button" data-id="${e}" data-action="edit" class="button-edit" data-modal-target="createCategory" data-modal-toggle="createCategory"><span class="fa-solid fa-pen-to-square"></span> Modificar</button>
                    <button type="button" data-id="${e}"  data-action="delete" class="button-cancel" data-modal-target="delete-modal" data-modal-toggle="delete-modal"><span class="fa-solid fa-trash"></span> Eliminar</button>
                `}}],classes:{active:"datatable-active",bottom:"datatable-bottom",container:"datatable-container",cursor:"datatable-cursor",dropdown:"datatable-dropdown",ellipsis:"datatable-ellipsis",empty:"datatable-empty",headercontainer:"datatable-headercontainer",info:"datatable-info",input:"datatable-input",loading:"datatable-loading",pagination:"datatable-pagination",paginationList:"datatable-pagination-list",search:"datatable-search",selector:"datatable-selector",sorter:"datatable-sorter",table:"datatable-table bg-color",top:"datatable-top text-center",wrapper:"datatable-wrapper text-center"},data:this.datos})},complete:()=>{this.loaderService.deactivateInternalSignal(),this.categorySuscription?.unsubscribe(),this.category.nativeElement.querySelectorAll("[data-action]").forEach(e=>{e.addEventListener("click",t=>{let n=t.currentTarget,d=n.getAttribute("data-action");this.mode.set(d==="edit"?"modify":"create"),this.categoryId.set(+n.getAttribute("data-id")),d==="create"&&this.resetForm.set(!0)})})},error:a=>{console.error("Error al obtener categor\xEDas:",a)}})}deleteCategory(){console.log("deleteCategory"),this.loaderService.activateInternalSignal(),this.categoryDeletedSuscription=this.categoryService.deleteCategory(this.categoryId()).subscribe({next:a=>{this.fetchCategories(),this.categoryCreated.set(!1),this.toastr.success("Categor\xEDa eliminada exitosamente")},complete:()=>{this.categoryDeletedSuscription?.unsubscribe(),this.loaderService.deactivateInternalSignal()},error:a=>{console.error("Error al eliminar categor\xEDa:",a),this.toastr.error(a.error.message)}})}ngAfterViewInit(){this.fetchCategories()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=u({type:l,selectors:[["app-categories"]],viewQuery:function(e,t){if(e&1&&w(me,5),e&2){let n;E(n=_())&&(t.category=n.first)}},decls:10,vars:6,consts:[["categoryWrapper",""],["category",""],["type","button","data-modal-target","createCategory","data-modal-toggle","createCategory",1,"button-internal-module",3,"click"],[1,"fa-solid","fa-plus"],[1,"ml-2"],[3,"categoryCreatedSignal","mode","categoryId","categories","resetForm"],[3,"actionCreateCategor"]],template:function(e,t){if(e&1){let n=x();r(0,"button",2),f("click",function(){return v(n),t.mode.set("create"),S(t.resetForm.set(!0))}),s(1,"span",3),r(2,"span",4),i(3,"Nueva categor\xEDa"),o()(),s(4,"app-create-category",5),r(5,"div",null,0),s(7,"table",null,1),o(),s(9,"app-delete-category",6)}e&2&&(c(4),m("categoryCreatedSignal",t.categoryCreated)("mode",t.mode)("categoryId",t.categoryId)("categories",t.categoriesSend)("resetForm",t.resetForm),c(5),m("actionCreateCategor",t.actionDeleteCategory))},dependencies:[V,A,D],encapsulation:2})};export{L as default};
