import{a as ee}from"./chunk-G5KA7DMQ.js";import{a as Y}from"./chunk-GNEIMZVK.js";import{a as Z}from"./chunk-YFVOBPZ4.js";import{b as Q}from"./chunk-TVQRLKHQ.js";import{a as N,b as f,c as T,d as j,e as G,f as q,g as D,h as P,i as A,j as U,k as B}from"./chunk-RRTRMW2P.js";import"./chunk-UISL6Y2D.js";import{a as $}from"./chunk-2Q24A73Y.js";import{c as R,d as O,h as V,j as W,l as z,p as H}from"./chunk-SPPYWUOE.js";import{a as J,b as K}from"./chunk-KSPYWLJG.js";import{a as te}from"./chunk-KY46OKNM.js";import{d as I}from"./chunk-GLYBJXTZ.js";import{a as M}from"./chunk-WAMUCK4W.js";import{h as L,m as F}from"./chunk-EJNWX7KC.js";import{a as X}from"./chunk-MGM6FGYC.js";import{Eb as l,Ja as m,Jb as y,N as k,Pa as w,T as s,Ua as x,Za as _,db as c,ib as b,mb as t,na as h,nb as i,ob as u,wb as p}from"./chunk-ZMWEMAWI.js";var S=class o{environments=$;http=s(M);seePass=h(!1);login(r){return this.http.post(this.environments.URL_LOGIN,r.value)}loginWithBusiness(r,n){return this.http.post(this.environments.URL_LOGIN_BUSINESS,r,{headers:{Authorization:`Bearer ${n}`}})}seePassword(){this.seePass.update(r=>!r)}static \u0275fac=function(n){return new(n||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})};var ie=o=>({"border-red-500!":o});function re(o,r){o&1&&(t(0,"p",15),l(1,"Este campo es requerido"),i())}function ne(o,r){o&1&&(t(0,"p",15),l(1,"El formato de correo es invalido"),i())}function ae(o,r){o&1&&(t(0,"p",15),l(1,"Este campo es requerido"),i())}var E=class o{constructor(r){this.darkModeService=r}value="";password="";faBars=R;faSun=W;faMoon=H;faGrip=z;faEye=V;faEyeSlash=O;datosUser=h(null);fb=s(A);recaptchaService=s(Q);activateLoader=s(X);toast=s(Y);loginService=s(S);router=s(I);toastr=s(Z);loginSuscription;ngOnInit(){this.activateLoader.deactivateSignal()}ngOnDestroy(){this.loginSuscription?.unsubscribe()}form=this.fb.group({email:["",[f.required,f.email]],password:["",[f.required,f.minLength(6)]],recaptchaToken:[""]});onSubmitLogin(){this.activateLoader.activateSignal(),this.loginSuscription=this.recaptchaService.execute("submitLogin").subscribe(r=>{this.form.get("recaptchaToken")?.setValue(r),this.loginService.login(this.form).subscribe({next:n=>{let e=ee(n.token);if(Array.isArray(e.id_business)&&e.id_business.length>1)this.router.navigate(["/choose-business"]),this.activateLoader.deactivateSignal();else{let a={email:e.email,id_business:Array.isArray(e.id_business)?e.id_business[0]:e.id_business};this.loginService.loginWithBusiness(a,n.token).subscribe({next:d=>{localStorage.setItem("auth_token",d.token),this.router.navigate(["/dashboard"])},error:d=>{this.toastr.error("Error al seleccionar el negocio"),console.error(d)},complete:()=>{this.activateLoader.deactivateSignal()}})}},error:n=>{console.error("Error en la solicitud de login:",n),this.activateLoader.deactivateSignal(),localStorage.removeItem("auth_token"),this.toastr.error(n.error.message)}})})}retrieveAccount(){this.router.navigate(["/retrieve-account"])}registration(){this.router.navigate(["/register"])}static \u0275fac=function(n){return new(n||o)(w(te))};static \u0275cmp=x({type:o,selectors:[["app-login"]],decls:38,vars:14,consts:[[1,"md:p-4","sm:pt-0","flex","items-center","justify-center","w-full","md:h-screen","bg-color-general"],[1,"cursor-pointer","absolute","top-2","right-2",3,"click"],[3,"icon"],[1,"w-full","h-screen","max-w-5xl","min-h-[50vh]","grid","grid-cols-1","md:grid-cols-2","items-center","justify-center","md:h-fit","overflow-hidden","bg-color","md:rounded-2xl","shadow-xl"],[1,"bg-color","shadow-xl","bg-color-custom","absolute","items-center","justify-center","text-center","top-0","left-0","h-[15rem]","w-full","md:relative","flex","md:w-full","rounded-b-[5rem]","md:rounded-bl-none","md:h-full","md:rounded-r-[15rem]"],[1,"flex","flex-col","items-center","gap-5"],[1,"font-bold","text-4xl"],[1,"text-xl"],[1,"button-behavior",3,"click"],[1,"rounded-2xl","pt-[15rem]","md:pt-0","p-7","md:pb-10","w-full"],[1,"flex","flex-col","justify-center",3,"ngSubmit","formGroup"],[1,"h2","mb-5","text-center"],["for","email",1,"label-behavior"],[1,"mb-10","relative"],["type","email","id","email","name","email","formControlName","email","placeholder","Escribe tu correo","required","",1,"input-behavior",3,"ngClass"],[1,"text-red-500","text-sm","mt-2","absolute"],["for","password",1,"label-behavior"],[1,"absolute","inset-y-0","end-3","flex","items-center","ps-3.5","cursor-pointer",3,"click"],["id","password","name","password","formControlName","password","placeholder","Escribe tu contrase\xF1a","required","",1,"input-behavior",3,"type","ngClass"],[1,"flex","items-center","justify-between"],[1,""],["type","submit",1,"bg-color-button","pt-5","pb-5",3,"disabled"],[1,"flex","justify-between","items-center","pt-3"],[1,"text-stone-800","cursor-pointer","dark:text-stone-100","text-sm","hover:text-blue-500",3,"click"],[1,"text-stone-800","dark:text-stone-100","text-sm"]],template:function(n,e){if(n&1&&(t(0,"div",0)(1,"button",1),p("click",function(){return e.darkModeService.toggleDarkMode()}),u(2,"fa-icon",2),i(),t(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2",6),l(7,"Bienvenido!"),i(),t(8,"p",7),l(9,"Inicia sesi\xF3n para continuar"),i(),t(10,"button",8),p("click",function(){return e.registration()}),l(11,"\xBFNo tienes cuenta?"),i()()(),t(12,"div",9)(13,"form",10),p("ngSubmit",function(){return e.onSubmitLogin()}),t(14,"h2",11),l(15,"Ingreso"),i(),t(16,"label",12),l(17,"Correo"),i(),t(18,"div",13),u(19,"input",14),_(20,re,2,0,"p",15)(21,ne,2,0,"p",15),i(),t(22,"label",16),l(23,"Contrase\xF1a"),i(),t(24,"div",13)(25,"div",17),p("click",function(){return e.loginService.seePassword()}),u(26,"fa-icon",2),i(),u(27,"input",18),_(28,ae,2,0,"p",15),i(),u(29,"div",19),t(30,"div",20)(31,"button",21),l(32," Entrar "),i()()(),t(33,"div",22)(34,"button",23),p("click",function(){return e.retrieveAccount()}),l(35,"Recuperar cuenta"),i(),t(36,"button",24),l(37,"Contactanos"),i()()()()()),n&2){let a,d,C,g,v;m(2),c("icon",e.darkModeService.darkMode()?e.faSun:e.faMoon),m(11),c("formGroup",e.form),m(6),c("ngClass",y(10,ie,((a=e.form.get("email"))==null?null:a.hasError("required"))&&((a=e.form.get("email"))==null?null:a.touched)||((a=e.form.get("email"))==null?null:a.hasError("email")))),m(),b((d=e.form.get("email"))!=null&&d.hasError("required")&&((d=e.form.get("email"))!=null&&d.touched)?20:-1),m(),b((C=e.form.get("email"))!=null&&C.hasError("email")?21:-1),m(5),c("icon",e.loginService.seePass()?e.faEyeSlash:e.faEye),m(),c("type",e.loginService.seePass()?"text":"password")("ngClass",y(12,ie,((g=e.form.get("password"))==null?null:g.hasError("required"))&&((g=e.form.get("password"))==null?null:g.touched))),m(),b((v=e.form.get("password"))!=null&&v.hasError("required")&&((v=e.form.get("password"))!=null&&v.touched)?28:-1),m(3),c("disabled",e.form.invalid)}},dependencies:[F,L,U,G,N,T,j,P,B,q,D,K,J],encapsulation:2})};export{E as default};
